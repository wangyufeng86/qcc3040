<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Trap API: IMAGEUPGRADE</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Trap API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__trapset__imageupgrade.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">IMAGEUPGRADE<div class="ingroups"><a class="el" href="group__api.html">Customer Trap API</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga88b5f9ee1e20ddfe815f6ded4ccff4d2"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__imageupgrade.html#ga88b5f9ee1e20ddfe815f6ded4ccff4d2">ImageUpgradeAbortCommand</a> (void)</td></tr>
<tr class="memdesc:ga88b5f9ee1e20ddfe815f6ded4ccff4d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Abort an ongoing image upgrade trap activity.  <a href="#ga88b5f9ee1e20ddfe815f6ded4ccff4d2">More...</a><br /></td></tr>
<tr class="separator:ga88b5f9ee1e20ddfe815f6ded4ccff4d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9444d4255bf78a5367c9471cffca6800"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__imageupgrade.html#ga9444d4255bf78a5367c9471cffca6800">ImageUpgradeAudio</a> (void)</td></tr>
<tr class="memdesc:ga9444d4255bf78a5367c9471cffca6800"><td class="mdescLeft">&#160;</td><td class="mdescRight">Erase the other image bank in the Audio QSPI and copy the new audio image from Apps QSPI to Audio QSPI device.  <a href="#ga9444d4255bf78a5367c9471cffca6800">More...</a><br /></td></tr>
<tr class="separator:ga9444d4255bf78a5367c9471cffca6800"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaed4b4fc89934f20e64497912bf2f1cef"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__imageupgrade.html#gaed4b4fc89934f20e64497912bf2f1cef">ImageUpgradeCopy</a> (void)</td></tr>
<tr class="memdesc:gaed4b4fc89934f20e64497912bf2f1cef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copy unmodified image sections to the new image bank.  <a href="#gaed4b4fc89934f20e64497912bf2f1cef">More...</a><br /></td></tr>
<tr class="separator:gaed4b4fc89934f20e64497912bf2f1cef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8fb57d127457d5dcef0890f5687e68f1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__imageupgrade.html#ga8fb57d127457d5dcef0890f5687e68f1">ImageUpgradeErase</a> (void)</td></tr>
<tr class="memdesc:ga8fb57d127457d5dcef0890f5687e68f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Erase the other image bank in all QSPI devices.  <a href="#ga8fb57d127457d5dcef0890f5687e68f1">More...</a><br /></td></tr>
<tr class="separator:ga8fb57d127457d5dcef0890f5687e68f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga28d002c79384ca1ce43806191cccccb5"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__imageupgrade.html#ga28d002c79384ca1ce43806191cccccb5">ImageUpgradeGetInfo</a> (uint16 qspi, image_section_id image_section, image_info_key key, uint32 *value)</td></tr>
<tr class="memdesc:ga28d002c79384ca1ce43806191cccccb5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Image upgrade traps specifically for DFU.  <a href="#ga28d002c79384ca1ce43806191cccccb5">More...</a><br /></td></tr>
<tr class="separator:ga28d002c79384ca1ce43806191cccccb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga77502ea3819ff5db0418eaf46d00cb45"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__imageupgrade.html#ga77502ea3819ff5db0418eaf46d00cb45">ImageUpgradeHashAllSectionsUpdate</a> (hash_context_t context)</td></tr>
<tr class="memdesc:ga77502ea3819ff5db0418eaf46d00cb45"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update the image upgrade hash validation context data with all the unerased image sections in the other image bank.  <a href="#ga77502ea3819ff5db0418eaf46d00cb45">More...</a><br /></td></tr>
<tr class="separator:ga77502ea3819ff5db0418eaf46d00cb45"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1fe310521433616a2bec8ceaf7f7d9d5"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__imageupgrade.html#ga1fe310521433616a2bec8ceaf7f7d9d5">ImageUpgradeHashFinalise</a> (hash_context_t context, uint8 *hash, uint16 hash_len_bytes)</td></tr>
<tr class="memdesc:ga1fe310521433616a2bec8ceaf7f7d9d5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the hash for the image upgrade hash context.  <a href="#ga1fe310521433616a2bec8ceaf7f7d9d5">More...</a><br /></td></tr>
<tr class="separator:ga1fe310521433616a2bec8ceaf7f7d9d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae908e860c3f202ab3d711adbdfcc6ac6"><td class="memItemLeft" align="right" valign="top">hash_context_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__imageupgrade.html#gae908e860c3f202ab3d711adbdfcc6ac6">ImageUpgradeHashInitialise</a> (hash_algo_t algo)</td></tr>
<tr class="memdesc:gae908e860c3f202ab3d711adbdfcc6ac6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialise a hash algorithm context for image upgrade.  <a href="#gae908e860c3f202ab3d711adbdfcc6ac6">More...</a><br /></td></tr>
<tr class="separator:gae908e860c3f202ab3d711adbdfcc6ac6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad522924555468513adee199c3284dab7"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__imageupgrade.html#gad522924555468513adee199c3284dab7">ImageUpgradeHashMsgUpdate</a> (hash_context_t context, const uint8 *msg, uint16 msg_len_bytes)</td></tr>
<tr class="memdesc:gad522924555468513adee199c3284dab7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update the image upgrade hash context with the input message.  <a href="#gad522924555468513adee199c3284dab7">More...</a><br /></td></tr>
<tr class="separator:gad522924555468513adee199c3284dab7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga51db10f32d4a9659662f24dfc14b7f5f"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__imageupgrade.html#ga51db10f32d4a9659662f24dfc14b7f5f">ImageUpgradeHashSectionUpdate</a> (hash_context_t context, image_section_id image_section)</td></tr>
<tr class="memdesc:ga51db10f32d4a9659662f24dfc14b7f5f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update the image upgrade hash context with the image section data read from the other image bank.  <a href="#ga51db10f32d4a9659662f24dfc14b7f5f">More...</a><br /></td></tr>
<tr class="separator:ga51db10f32d4a9659662f24dfc14b7f5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5defbd1032774770910fccc5502accbc"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__imageupgrade.html#ga5defbd1032774770910fccc5502accbc">ImageUpgradeSinkGetPosition</a> (<a class="el" href="sink___8h.html#a250a23fcb6a29255bb2526a002d691b2">Sink</a> sink, uint32 *offset)</td></tr>
<tr class="memdesc:ga5defbd1032774770910fccc5502accbc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the current sink write position (in bytes) of the image section sink stream.  <a href="#ga5defbd1032774770910fccc5502accbc">More...</a><br /></td></tr>
<tr class="separator:ga5defbd1032774770910fccc5502accbc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa3beb864cbb7126561395bd4f0c2a512"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sink___8h.html#a250a23fcb6a29255bb2526a002d691b2">Sink</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__imageupgrade.html#gaa3beb864cbb7126561395bd4f0c2a512">ImageUpgradeStreamGetSink</a> (uint16 qspi, image_section_id image_section, uint32 first_word)</td></tr>
<tr class="memdesc:gaa3beb864cbb7126561395bd4f0c2a512"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the stream sink handle for the image section.  <a href="#gaa3beb864cbb7126561395bd4f0c2a512">More...</a><br /></td></tr>
<tr class="separator:gaa3beb864cbb7126561395bd4f0c2a512"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0b1370fc3f7a2ace5860b80a864487f8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="source___8h.html#afbe187e42995c6b6af38624c70e7a3e2">Source</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__imageupgrade.html#ga0b1370fc3f7a2ace5860b80a864487f8">ImageUpgradeStreamGetSource</a> (uint16 qspi, image_section_id image_section)</td></tr>
<tr class="memdesc:ga0b1370fc3f7a2ace5860b80a864487f8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the stream source handle for the image section.  <a href="#ga0b1370fc3f7a2ace5860b80a864487f8">More...</a><br /></td></tr>
<tr class="separator:ga0b1370fc3f7a2ace5860b80a864487f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac28a1e4609ca9a452dbec5c7e2909597"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__imageupgrade.html#gac28a1e4609ca9a452dbec5c7e2909597">ImageUpgradeSwapCommit</a> (void)</td></tr>
<tr class="memdesc:gac28a1e4609ca9a452dbec5c7e2909597"><td class="mdescLeft">&#160;</td><td class="mdescRight">Swap the image bank by modifying the boot image in the QSPI device.  <a href="#gac28a1e4609ca9a452dbec5c7e2909597">More...</a><br /></td></tr>
<tr class="separator:gac28a1e4609ca9a452dbec5c7e2909597"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga43686ccae4a7d0ba6103ba96f5a61606"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__imageupgrade.html#ga43686ccae4a7d0ba6103ba96f5a61606">ImageUpgradeSwapTry</a> (void)</td></tr>
<tr class="memdesc:ga43686ccae4a7d0ba6103ba96f5a61606"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset the chip, load and run using the images (if present) from the other image bank in all QSPI devices.  <a href="#ga43686ccae4a7d0ba6103ba96f5a61606">More...</a><br /></td></tr>
<tr class="separator:ga43686ccae4a7d0ba6103ba96f5a61606"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga86f4c84645498292ae2cc7dd44e95ed2"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__imageupgrade.html#ga86f4c84645498292ae2cc7dd44e95ed2">ImageUpgradeSwapTryStatus</a> (void)</td></tr>
<tr class="memdesc:ga86f4c84645498292ae2cc7dd44e95ed2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the status of images (if present) running from the other image bank in all QSPI devices.  <a href="#ga86f4c84645498292ae2cc7dd44e95ed2">More...</a><br /></td></tr>
<tr class="separator:ga86f4c84645498292ae2cc7dd44e95ed2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga88b5f9ee1e20ddfe815f6ded4ccff4d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga88b5f9ee1e20ddfe815f6ded4ccff4d2">&#9670;&nbsp;</a></span>ImageUpgradeAbortCommand()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ImageUpgradeAbortCommand </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Abort an ongoing image upgrade trap activity. </p>
<dl class="section note"><dt>Note</dt><dd>For now, only an ongoing ImageUpgradeCopy trap execution will be aborted by invoking ImageUpgradeAbortCommand trap.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>TRUE if aborting an ongoing image upgrade activity is successful, else FALSE. </dd></dl>

</div>
</div>
<a id="ga9444d4255bf78a5367c9471cffca6800"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9444d4255bf78a5367c9471cffca6800">&#9670;&nbsp;</a></span>ImageUpgradeAudio()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ImageUpgradeAudio </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Erase the other image bank in the Audio QSPI and copy the new audio image from Apps QSPI to Audio QSPI device. </p>
<dl class="section note"><dt>Note</dt><dd>The application should invoke this trap before invoking the trap to try the new image (ImageUpgradeSwapTry) to copy the new audio image from the Apps QSPI to the Audio QSPI on platforms in which the audio is running from the external QSPI (flash) device. As Apps P0 has to get exclusive access to the Audio QSPI to do the copy, it's expected that the all the audio services are stopped before invoking this trap. Also, no new audio services should be started before the Apps P0 returns the status of the trap in #MessageImageUpgradeAudioStatus. </dd></dl>

</div>
</div>
<a id="gaed4b4fc89934f20e64497912bf2f1cef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaed4b4fc89934f20e64497912bf2f1cef">&#9670;&nbsp;</a></span>ImageUpgradeCopy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ImageUpgradeCopy </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Copy unmodified image sections to the new image bank. </p>
<dl class="section note"><dt>Note</dt><dd>The application should invoke this trap to copy unmodified image sections during an image upgrade from the boot image bank to the new image bank before resetting the chip using the new image bank. It's expected that the application shall abort copying of the image sections by invoking <a class="el" href="group__trapset__imageupgrade.html#ga88b5f9ee1e20ddfe815f6ded4ccff4d2" title="Abort an ongoing image upgrade trap activity. ">ImageUpgradeAbortCommand()</a> trap if the Host application aborts the image update in between. It's expected that the application will only invoke this trap when images are running from the boot image bank in all QSPI devices. </dd></dl>

</div>
</div>
<a id="ga8fb57d127457d5dcef0890f5687e68f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga8fb57d127457d5dcef0890f5687e68f1">&#9670;&nbsp;</a></span>ImageUpgradeErase()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ImageUpgradeErase </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Erase the other image bank in all QSPI devices. </p>
<dl class="section note"><dt>Note</dt><dd>It's expected that the application will only invoke this trap when images are running from the boot image bank in all QSPI devices. </dd></dl>

</div>
</div>
<a id="ga28d002c79384ca1ce43806191cccccb5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga28d002c79384ca1ce43806191cccccb5">&#9670;&nbsp;</a></span>ImageUpgradeGetInfo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ImageUpgradeGetInfo </td>
          <td>(</td>
          <td class="paramtype">uint16&#160;</td>
          <td class="paramname"><em>qspi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">image_section_id&#160;</td>
          <td class="paramname"><em>image_section</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">image_info_key&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32 *&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Image upgrade traps specifically for DFU. </p>
<p>file Get information about an image section. </p><dl class="section note"><dt>Note</dt><dd>It's expected that the application will only invoke this trap when the image is running from the boot image bank in the input QSPI device.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">qspi</td><td>QSPI device number where the image section is written. </td></tr>
    <tr><td class="paramname">image_section</td><td>Image section. </td></tr>
    <tr><td class="paramname">key</td><td>Image upgrade info key. </td></tr>
    <tr><td class="paramname">value</td><td>Address to return the value of the key. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Successful in getting the requested information about an image section. </dd></dl>

</div>
</div>
<a id="ga77502ea3819ff5db0418eaf46d00cb45"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga77502ea3819ff5db0418eaf46d00cb45">&#9670;&nbsp;</a></span>ImageUpgradeHashAllSectionsUpdate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ImageUpgradeHashAllSectionsUpdate </td>
          <td>(</td>
          <td class="paramtype">hash_context_t&#160;</td>
          <td class="paramname"><em>context</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update the image upgrade hash validation context data with all the unerased image sections in the other image bank. </p>
<dl class="section note"><dt>Note</dt><dd>The application should invoke this trap to add all the image sections included in an image upgrade to the hash validation context created in <a class="el" href="group__trapset__imageupgrade.html#gae908e860c3f202ab3d711adbdfcc6ac6" title="Initialise a hash algorithm context for image upgrade. ">ImageUpgradeHashInitialise()</a> trap. Apps P0 shall update the hash context in the background and shall return the status of the trap in #MessageImageUpgradeHashAllSectionsUpdateStatus. This trap should be invoked before copying (ImageUpgradeCopy trap) the missing image sections from the boot image bank to the other image bank during a partial image upgrade. This trap should be invoked as an alternative to the <a class="el" href="group__trapset__imageupgrade.html#ga51db10f32d4a9659662f24dfc14b7f5f" title="Update the image upgrade hash context with the image section data read from the other image bank...">ImageUpgradeHashSectionUpdate()</a> trap in which the Apps P0 updates the input image section blocking the Apps P1. It's not expected that the application will invoke both <a class="el" href="group__trapset__imageupgrade.html#ga51db10f32d4a9659662f24dfc14b7f5f" title="Update the image upgrade hash context with the image section data read from the other image bank...">ImageUpgradeHashSectionUpdate()</a> and <a class="el" href="group__trapset__imageupgrade.html#ga77502ea3819ff5db0418eaf46d00cb45" title="Update the image upgrade hash validation context data with all the unerased image sections in the oth...">ImageUpgradeHashAllSectionsUpdate()</a> to add image sections to the same hash context.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">context</td><td>Hash context. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga1fe310521433616a2bec8ceaf7f7d9d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1fe310521433616a2bec8ceaf7f7d9d5">&#9670;&nbsp;</a></span>ImageUpgradeHashFinalise()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ImageUpgradeHashFinalise </td>
          <td>(</td>
          <td class="paramtype">hash_context_t&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8 *&#160;</td>
          <td class="paramname"><em>hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16&#160;</td>
          <td class="paramname"><em>hash_len_bytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate the hash for the image upgrade hash context. </p>
<dl class="section note"><dt>Note</dt><dd>The context can be freed by invoking ImageUpgradeHashFinalise trap with NULL hash pointer.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">context</td><td>Hash context. </td></tr>
    <tr><td class="paramname">hash</td><td>Pointer to return the hash. </td></tr>
    <tr><td class="paramname">hash_len_bytes</td><td>Length (in bytes) of the expected hash. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>TRUE if the image upgrade hash is successfully calculated, else FALSE. </dd></dl>

</div>
</div>
<a id="gae908e860c3f202ab3d711adbdfcc6ac6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae908e860c3f202ab3d711adbdfcc6ac6">&#9670;&nbsp;</a></span>ImageUpgradeHashInitialise()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">hash_context_t ImageUpgradeHashInitialise </td>
          <td>(</td>
          <td class="paramtype">hash_algo_t&#160;</td>
          <td class="paramname"><em>algo</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialise a hash algorithm context for image upgrade. </p>
<dl class="section note"><dt>Note</dt><dd>The returned context doesn't need to be interpreted by the application, but should be passed in the subsequent image upgrade hash traps to update and finalise the hash data to the same context. The created context can be freed by invoking ImageUpgradeHashFinalise trap with NULL hash pointer.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">algo</td><td>Hash algorithm. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Hash context pointer. </dd></dl>

</div>
</div>
<a id="gad522924555468513adee199c3284dab7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad522924555468513adee199c3284dab7">&#9670;&nbsp;</a></span>ImageUpgradeHashMsgUpdate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ImageUpgradeHashMsgUpdate </td>
          <td>(</td>
          <td class="paramtype">hash_context_t&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8 *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16&#160;</td>
          <td class="paramname"><em>msg_len_bytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update the image upgrade hash context with the input message. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">context</td><td>Hash context. </td></tr>
    <tr><td class="paramname">msg</td><td>Pointer to the input message. </td></tr>
    <tr><td class="paramname">msg_len_bytes</td><td>Length (in bytes) of the input message. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>TRUE if the image upgrade hash context is successfully updated, else FALSE. </dd></dl>

</div>
</div>
<a id="ga51db10f32d4a9659662f24dfc14b7f5f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga51db10f32d4a9659662f24dfc14b7f5f">&#9670;&nbsp;</a></span>ImageUpgradeHashSectionUpdate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ImageUpgradeHashSectionUpdate </td>
          <td>(</td>
          <td class="paramtype">hash_context_t&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">image_section_id&#160;</td>
          <td class="paramname"><em>image_section</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update the image upgrade hash context with the image section data read from the other image bank. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">context</td><td>Hash context. </td></tr>
    <tr><td class="paramname">image_section</td><td>Image section. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>TRUE if the hash context is successfully updated, else FALSE. </dd></dl>

</div>
</div>
<a id="ga5defbd1032774770910fccc5502accbc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5defbd1032774770910fccc5502accbc">&#9670;&nbsp;</a></span>ImageUpgradeSinkGetPosition()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ImageUpgradeSinkGetPosition </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sink___8h.html#a250a23fcb6a29255bb2526a002d691b2">Sink</a>&#160;</td>
          <td class="paramname"><em>sink</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32 *&#160;</td>
          <td class="paramname"><em>offset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the current sink write position (in bytes) of the image section sink stream. </p>
<dl class="section note"><dt>Note</dt><dd>This API is used to get the sink position of the specified image upgrade sink in octets. Firmware returns a sink position from which, each word has a value of 0xFFFF till the end of the image section. Firmware assumes that the image section contents before the sink position are successfully written.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sink</td><td>Sink handle for the image upgrade stream. </td></tr>
    <tr><td class="paramname">offset</td><td>Sink write position of the specified image upgrade sink. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>TRUE if Successful in getting the sink write position of the specified image upgrade sink, otherwise FALSE </dd></dl>

</div>
</div>
<a id="gaa3beb864cbb7126561395bd4f0c2a512"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa3beb864cbb7126561395bd4f0c2a512">&#9670;&nbsp;</a></span>ImageUpgradeStreamGetSink()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sink___8h.html#a250a23fcb6a29255bb2526a002d691b2">Sink</a> ImageUpgradeStreamGetSink </td>
          <td>(</td>
          <td class="paramtype">uint16&#160;</td>
          <td class="paramname"><em>qspi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">image_section_id&#160;</td>
          <td class="paramname"><em>image_section</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32&#160;</td>
          <td class="paramname"><em>first_word</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the stream sink handle for the image section. </p>
<dl class="section note"><dt>Note</dt><dd>The sink handle returned should be used to write the image section data into the QSPI device using the stream traps. Application shouldn't use this sink handle to connect to any other stream types using <a class="el" href="group__trapset__stream.html#ga4cd351636d2d317e6bd2f4c5f76968d4" title="Make an automatic connection between a source and sink. ">StreamConnect()</a> trap. It's expected that the application will only invoke this trap when the image is running from the boot image bank in the input QSPI device.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">qspi</td><td>QSPI device number where the image section is written. </td></tr>
    <tr><td class="paramname">image_section</td><td>Image section. </td></tr>
    <tr><td class="paramname">first_word</td><td>First 4 bytes of the image section which is written when the stream is closed. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Stream sink handle for writing the image section in the QSPI device. </dd></dl>

</div>
</div>
<a id="ga0b1370fc3f7a2ace5860b80a864487f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0b1370fc3f7a2ace5860b80a864487f8">&#9670;&nbsp;</a></span>ImageUpgradeStreamGetSource()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="source___8h.html#afbe187e42995c6b6af38624c70e7a3e2">Source</a> ImageUpgradeStreamGetSource </td>
          <td>(</td>
          <td class="paramtype">uint16&#160;</td>
          <td class="paramname"><em>qspi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">image_section_id&#160;</td>
          <td class="paramname"><em>image_section</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the stream source handle for the image section. </p>
<dl class="section note"><dt>Note</dt><dd>The source handle returned should be used to read the image section data in the QSPI device using the stream traps. The source will contain first_word (written using ImageUpgradeStreamGetSink api) followed by rest of image section data. Application shouldn't use this source handle to connect to any other stream types using <a class="el" href="group__trapset__stream.html#ga4cd351636d2d317e6bd2f4c5f76968d4" title="Make an automatic connection between a source and sink. ">StreamConnect()</a> trap. It's expected that the application will only invoke this trap when the image is running from the boot image bank in the input QSPI device.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">qspi</td><td>QSPI device number from where image section is read. </td></tr>
    <tr><td class="paramname">image_section</td><td>Image section. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Stream source handle for reading the image section in the QSPI device. </dd></dl>

</div>
</div>
<a id="gac28a1e4609ca9a452dbec5c7e2909597"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac28a1e4609ca9a452dbec5c7e2909597">&#9670;&nbsp;</a></span>ImageUpgradeSwapCommit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ImageUpgradeSwapCommit </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Swap the image bank by modifying the boot image in the QSPI device. </p>
<dl class="section note"><dt>Note</dt><dd>It's expected that the application will only invoke this trap when images are running from the other (new) image bank in all QSPI devices.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>Boot image successfully updated. </dd></dl>

</div>
</div>
<a id="ga43686ccae4a7d0ba6103ba96f5a61606"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga43686ccae4a7d0ba6103ba96f5a61606">&#9670;&nbsp;</a></span>ImageUpgradeSwapTry()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ImageUpgradeSwapTry </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reset the chip, load and run using the images (if present) from the other image bank in all QSPI devices. </p>
<dl class="section note"><dt>Note</dt><dd>It's expected that the application will only invoke this trap when images are running from the boot image bank in all QSPI devices, and there are valid images in the other (new) image bank in all QSPI devices. </dd></dl>

</div>
</div>
<a id="ga86f4c84645498292ae2cc7dd44e95ed2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga86f4c84645498292ae2cc7dd44e95ed2">&#9670;&nbsp;</a></span>ImageUpgradeSwapTryStatus()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ImageUpgradeSwapTryStatus </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the status of images (if present) running from the other image bank in all QSPI devices. </p>
<dl class="section return"><dt>Returns</dt><dd>Images successfully running from the other image bank. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
